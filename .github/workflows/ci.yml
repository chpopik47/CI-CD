  docker-smoke:
    runs-on: ubuntu-latest
    needs: test
    steps:
      - uses: actions/checkout@v4

      - name: Build image
        run: docker build -t clinic-api:ci .

      - name: Run container
        run: docker run -d -p 8000:8000 --name clinic-api clinic-api:ci

      - name: Wait
        run: sleep 2

      - name: Healthcheck
        run: curl -f http://127.0.0.1:8000/health

      - name: Logs on failure
        if: failure()
        run: docker logs clinic-api

      - name: Cleanup
        if: always()
        run: docker rm -f clinic-api
